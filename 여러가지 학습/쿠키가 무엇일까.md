# 쿠키



- Set-Cookie: 서버에서 클라이언트로 쿠키 전달(응답)
- Cookie: 클라이언트가 서버에서 받은 쿠키를 저장하고, HTTP 요청시 서버로 전달



예를 통해 알아보자.

쿠키를 미사용하는 경우, 로그인한다고 과정해보자. 로그인 이후 특정 페이지에 접근한다고 해보자. 근데 쿠키가 없으면 로그인 했는지 안했는지 서버입장에선 구분할 방법이 없다. HTTP 연결 다되면 끊어버리므로, 참고로 당연히 무상태 프로토콜이 기본적이다. 그래서 이전 요청을 기억하지 못한다. 서로 상태를 유지하지 않으니 어쩔 수 없다.

그래서 대안으로 모든 요청에 사용자 정보를 포함해서 보내면 된다. 그러면 이제 서버가 알 수 있다. 근데 이 방식엔 문제가 있다. 그 이후 모든 요청에 사용자 정보를 다 포함해야 한다. 그럼 개발자가 그걸 참고해서 개발해야 하고, 브라우저를 완전히 종료하고 다시 열면 어떡하는가, 그리고 보안도 문제가 있다.

그래서 해결 방법으로 쿠키라는 것이 있다. 내가 로그인을 하면 서버는 Set-Cookie라고 해서 유저 정보를 쿠키에 넣고 응답해준다. 그럼 웹브라우저는 쿠키 저장소에 저장해둔다. 그리고 이제 웹브라우저가 그 사이트에 갈때 쿠키를 무조건 뒤져본다. 있으면 같이 보낸다. 그러면 이제 서버는 쿠키 열어보고 사용자가 누구인지 확인할 수 있는 것이다. 모든 요청에 쿠키 정보는 자동으로 포함된다. 뭐로 보내도 무조건 포함한다.



**쿠키의 사용처**

- 사용자 로그인 세션 관리

- 광고 정보 트래킹

쿠키 정보는 항상 서버에 전송된다.

- 네트워크 트래픅 추가 유발
- 최소한의 정보만 사용(세션 id, 인증 토큰)해야 한다..
- 서버에 전송하지 않고, 웹 브라우저 내부에 데이터를 저장하고 싶으면 웹 스토리지 참고

주의할 점!

- **보안에 민감한 데이터는 저장하면 안된다. (주민번호, 신용카드 번호 등등)**



#### 쿠키의 생명주기

- Set-Cookie: expires=Sat, 26-Dec-2020 04:39:21 GMT
  - 만료일이 되면 쿠키 삭제
- 세션 쿠키: 만료 날짜를 생략하면 브라우저 종료시 까지만 유지
- 영속 쿠키: 만료 날짜를 입력하면 해당 날짜까지 유지



#### 쿠키 도메인

도메인을 지정할 수 있다.

예) domain=example.org

명시하면 명시한 문서 기준 도메인 + 서브 도메인 포함해서 다 전송한다.

example.org는 물론이고 dev.example.org도 쿠키 접근한다

생략하면 현재 문서 기준 도메인만 적용된다.



#### 쿠키 경로

예) path=/home

일반적으로 path=/ 루트로 지정한다 그러면 이 경로를 포함한 하위 경로 페이지만 쿠키 접근한다. 



#### 쿠키 보안, 필요할 때 찾아보자.

- Secure: 적용하면 https인 경우에만 전송한다
- HttpOnly: XSS 공격방지, 자바스크립트에서 접근 불가, HTTP전송에만 사용
- SameSite: XSRF 공격 방지, 요청 도메인가 쿠키에 설정된 도메인이 같은 경우에만 쿠키 전송