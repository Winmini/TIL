# OSI - Third Layer

3계층은 네트워크 계층이다.



#### 네트워크 간의 연결구조

다른 네트워크에 있는 목적지로 데이터를 전달하려면 네트워크 계층의 기술이 필요하다. 데이터 링크 계층에선 이더넷 규칙을 통해 데이터를 전송했는데, 이 규칙을 이용하면 같은 네트워크에 있는 데이터로는 전송할 수 있지만, 인터넷이나 다른 네트워크로는 전달할 수가 없다.

네트워크 간의 통신을 가능하게 하는 것이 네트워크 계층의 역할이다. 이 계층을 통해 다른 네트워크로 데이터를 전송하려면 **라우터라는 네트워크 장비**가 필요하다.

라우터는 데이터의 목적지가 정해지면 해당 목적지까지 어떤 경로로 가는 것이 좋은지 알려주는 기능을 한다. 라우터를 설치하면 인터넷도 연결이 가능하고 해외로도 데이터를 보낼 수 있다. 하지만 데이터를 보내려는 상대가 어디에 있는지 모르면 라우터도 경로를 알려주지 못한다. 목적지 주소가 반드시 있어야 하는데 그 목적지 주소를 **IP 주소**라고 한다. 이렇게 목적지를 지정하고 나면 **어떤 경로**로 보낼지도 결정해야 하는데 이를 **라우팅**이라고 한다. 라우팅은 라우터가 한다.



### IP

네트워크 계층에는 IP라는 프로토콜이 있다. 네트워크 계층에서 캡슐화할 때 IP헤더를 붙인다. 버전, 헤더 길이, 서비스 유형, 패킷길이, 일련번호, 출발지 IP주소, 목적지 OP 주소 등으로 헤더를 만들어서 데이터에 붙인다. 데이터를 정확헤 전달하기 위해 필요한 정보를 붙이는 것이다.

제일 중요한 것은 출발지 IP주소와 목적지 IP주소가 있다는 정도만 기억하면 된다. IP 프로토콜을 사용하여 캡슐화할 때는 데이터에 IP 헤더가 추가되는데, 이를 **IP 패킷**이라고 한다.



#### IP 주소

IP 주소는 실생활의 주소같은 개념이다. 다른 네트워크의 목적지로 보내기 위해서는 IP 주소가 필요하다. 이 ISP 주소는 인터넷 서비스 제공자(통신사)에게 받을 수 있다. IP 버전에는 IPv4와 IPv6가 있다. 원래 IP 주소를 만들 때 43억 개면 충분하다고 생각했는데, 인터넷이 널리 보급되면서 IPv6를 사용하게 됐다. 앞으로는 v6를 사용하겠지만 한동안은 공존할 것이다.

IP 주소에는 공인 IP주소와 사설 IP주소가 있다. 참고로 공인 IP 주소는 인터넷 서비스 제공자가 제공한다. IP주소가 고갈되어 가는 중이라서 인터넷에 직접 연결되는 컴퓨터나 라우터에는 공인 IP를 사용하고 회사나 가정의 랜에 있는 컴퓨터는 사설 IP를 할당하는 정책을 사용한다. 외부에서는 공인 IP로 도달하고 도달하면 라우터를 통해 사설 IP로 접근하는 것이다.

IP 주소는 또다시 **네트워크 ID**와 **호스트 ID**로 나눠져 있다. 네트워크 ID는 어떤 네트워크인지, 호스트는 해당 네트워크의 어느 컴퓨터인지를 나타낸다.



#### IP 주소 클래스

IPv4의 IP 주소는 32비트다. 비트로 구분하지만 네트워크 ID를 크게 만들거나 호스트 ID를 작게 만들어 네트워크 크기를 조정할 수도 있다. 네트워크 크기는 클래스라는 개념으로 구분하고 있다.

비율은 ( 네트워크 ID : 호스트 ID ) 비트 비율이다.

- A 클래스: 대규모 네트워크 주소 ( 8 : 24 ), 호스트 수 최대 1677만대
- B 클래스: 중형 네트워크 주소 ( 16 : 16 ), 호스트 수 최대 6.5만대
- C 클래스: 소규모 네트워크 주소 ( 24 : 8 ) 호스트 수 최대 254대
- D 클래스: 멀티캐스트 주소
- E 클래스: 연구 및 특수용도 주소



#### 네트워크 주소와 브로드캐스트 주소의 구조

컴퓨터에 할당할 수 없는 IP 주소인 네트워크 주소와 브로드캐스트 주소가 있다. 이 두 주소는 특별한 주소로 **컴퓨터나 라우터가 자신의 IP로 사용하면  안 되는 주소**이다. 네트워크 주소는 호스트 ID 가 0인 주소이고, 브로드캐스트 주소는 호스트 ID가 255인 주소이다.

- 네트워크 주소의 예: 192.168.1.0
- 브로드캐스트 주소의 예: 192.168.1.255

네트워크 주소는 전체 네트워크에서 작은 네트워크를 식별하는 데 사용된다. 호스트 ID가 10진수로 0이면 그 **네트워크 전체를 대표하는 주소**가 된다. 브로드캐스트 주소는 **해당 네트워크에 있는 컴퓨터나 장비 모두에게 한 번에 데이터를 전송하는 데 사용되는 전용 IP 주소**다.



#### 서브넷

IP 주소는 A, B, C클래스로 나누어져 있었다. A 클래스의 경우 최대 1677만대 가량의 컴퓨터가 연결될 수 있는데, 이 많은 수에 브로드캐스트 패킷을 전송하면 모든 컴퓨터에 패킷이 전송되고 네트워크가 혼잡해질 것이다. 그래서 이런 대규모 네트워크를 작은 네트워크로 분할하여 브로드캐스트로 전송되는 패킷의 범위를 좁힐 수 있다. 이렇게 네트워크를 분할하는 것을 서브넷팅이라고 한다. 그리고 **분할된 네트워크를 서브넷**이라고 한다. 서브넷은 호스트 ID로 사용되던 비트를 빌려서 서브넷으로 만든다.

그래서 네트워크 ID (8비트) : 서브넷 ID (n비트) : 호스트 ID(24 - n비트) 와 같은 구조가 된다.



#### 서브넷 마스크

IP 주소를 서브넷팅하면 어디까지가 네트워크 ID고 어디까지가 호스트 ID인지 판단하기가 어려울 수 있다. 그럴 떄는 서브넷 마스크라는 값을 사용한다. 서브넷 마스크는 네트워크 ID와 호스트 ID를 식별하기 위한 값이다.



#### 라우터

서로 다른 네트워크와 통신하려면 라우터가 필요했었다. 분할된 네트워크에서 어떻게 컴퓨터가 다른 네트워크에 접속할 수 있을까? 다른 네트워크에 데이터를 전송하려면 라우터의 IP 주소를 설정해야 한다. 네트워크의 출입구를 설정하는 것으로 **기본 게이트웨이**라고 한다. 라우터의 IP 주소가 `192.168.1.1`이라고 하자. 그러면 컴퓨터의 기본 게이트 웨이를 라우터의 IP 주소인 `192.168.1.1` 로 설정한다. 1번 컴퓨터는 다른 네트워크로 데이터를 보낼 때 어디로 전송해야 하는지 알지 못한다. 그래서 일단 네트워크의 출입구를 지정하고 라우터로 데이터를 전송한다.

기본 게이트웨이가 설정되었지만 아직은 다른 컴퓨터에 데이터를 보낼 수 없다. 보내기 위해서는 라우터의 **라우팅** 기능이 필요하다.

**라우팅**: 경로 정보를 기반으로 현재의 네트워크에서 다른 네트워크로 최적의 경로를 통해 데이터를 전송하는 것, 그리고 경로 정보가 등록되어 있는 것이 **라우팅 테이블**이다. 각 라우터마다 라우팅 테이블에 경로 정보가 등록되어 있어서 라우팅이 가능하다. 라우팅 테이블은 수동, 자동으로 등록이 가능하며, 자동은 라우터 간에 경로 정보를 서로 교환하여 테이블 정보를 자동으로 수정한다. 이렇게 라우터 간에 라우팅 정보를 교환하기 위한 프로토콜을 **라우팅 프로토콜**이라 한다.