# OSI - Second Layer

OSI 모델의 2계층은 데이터 링크 계층이다.



#### 이더넷

데이터 링크 계층은 네트워크 장비 간에 신호를 주고받는 규칙을 정하는 계층으로, 랜에서 데이터를 정상적으로 주고받기 위해 필요한 계층이다. 그 규칙들 중 일반적으로 가장 많이 사용되는 규칙이 이더넷이다. 앞서 허브는 수신자 구분 없이 모든 포트에 데이터를 보냈는데, 받으려고 하는 컴퓨터를 제외한 컴퓨터는 볼 필요가 없다. 그래서 데이터엔 목적지 정보를 추가해서 보낼 수 있고, 이 외의 컴퓨터는 무시하게 되어 있다. 확실히 무시하도록 규칙으로 정해져 있어서 무시하지 않는 컴퓨터 문제는 절대 발생하지 않는다.

만약 컴퓨터 여러 대가 동시에 데이터를 보내면 어떻게 될까? 데이터가 서로 부딪히는 것을 충돌이라고 한다. 그래서 이더넷은 여러 컴퓨터가 동시에 데이터를 전송해도 충돌이 일어나지 않는 구조로 되어 있다. 만약 동시에 케이블을 지나가면 충돌할 수 밖에 없기 때문에 데이터 보내는 시점을 늦춘다. 이렇게 시점을 늦추는 방법을 **CSMA/CD (Carrier Sense Multiple Access with Collision Detection)** 라고 한다. 근데 이렇게 되면 동시에 데이터를 보내지 않으므로 충돌은 일어나지 않지만, 효율이 좋지 않다.

그래서 이 역시 스위치라는 네트워크 장비를 사용해서 개선한다.



#### MAC 주소의 구조

랜 카드는 비트열을 전기 신호로 변환한다고 했다. 이런 랜 카드에는 MAC 주소라는 번호가 정해져 있다. 제조할 때 새겨지기 때문에 물리 주소라고도 부르는데 **전 세계에서 유일한 번호**로 할당되어 있다. 중복되지 않도록 명확한 규정이 있다. 48비트 숫자로 되어 있으며, 앞 24비트는 랜 카드를 만든 제조사 번호고 뒤쪽 24비트는 제조사가 랜 카드에 붙인 일련번호다.

MAC 주소를 사용한 통신에 대해 알아보자. TCP/IP 모델을 떠올리면 각 계층에서 헤더를 붙였었다.  그리고 그 중 네트워크 계층에서 **이더넷 헤더와 트레일러**를 붙인다. 이더넷 헤더는 목적지의 MAC 주소, 출발지 AMC 주소, **유형**(상위 프로계층 프로토콜의 종류), 이렇게 총 14바이트로 구성되어 있다. 또한 트레일러는 FCS라고도 하는데, 데이터 전송 도중에 오류가 발생하는지 확인하는 용도이다. 이처럼 이더넷 헤더와 트레일러가 추가된 데이터를 **프레임**이라고 한다. 즉 네트워크를 통해 프레임이 전송되는 것이다. 이 프레임은 허브를 통해 다른 컴퓨터에 도달한다면 목적지 MAC의 주소가 자신의 MAC주소와 다를 수 있다. 이런 경우 데이터를 파기한다.



#### 스위치

스위치는 데이터 충돌이 발생하지 않아서 네트워크 구성에서 빠질 수 없다.

스위치는 **데이터 링크 계층**에서 동작하고 레이어 2 스위치 또는 스위칭 허브라고도 불린다. 스위치 내부에는 MAC 주소 테이블이라는 것이 있다. MAC 주소 테이블이란 스위치의 포트 번호와 해당 포트에 연결되어 있는 컴퓨터의 MAC 주소가 등록되는 데이터베이스다. 처음에는 아무것도 등록되어 있지 않지만 MAC 주소가 추가된 프레임이라는 데이터가 전송되면 MAC 주소 테이블을 확인한다. 만약 없는 MAC 주소라면 포트와 함께 등록한다. 초창기엔 나머지 포트에 뭐가 연결되어 있는지 모르므로 모든 포트에 프레임을 전송할 수 밖에 없고 이 전송을 **플러딩**이라고 부른다. 만약 테이블에 MAC 주소가 있다면 해당 포트로만 데이터를 보내게 된다. 이를 MAC 주소 필터링이라 한다.



#### 전이중 통신과 반이중 통신

데이터가 충돌하지 않는 구조에 대해서 알아보자. 통신 방식에는 2가지 통신이 있다. 하나는 전이중 통신 방식으로 데이터의 송수신을 **동시에** 하는 방식이고, 나머지 하나는 반 이중 통신으로 회선 하나에 **송신과 수신을 번갈아가면서** 통신하는 방식이다.

전이중 통신 방식은 데이터를 동시에 전송해도 충돌이 발생하지 않지만 반이중은 충돌이 발생한다. 예를 들어 컴퓨터 두 대를 서로 랜 케이블로 연결한다면(크로스 케이블), 전이중 통신 방식이 되며 동시에 전송해도 문제 없다. 반면 허브 같은 것은 내부에 송, 수신이 나누어져 있지 않아 동시에 전송하면 충돌이 일어날 수 밖에 없다.

스위치는 충돌이 일어나지 않는 구조로 되어 있기 때문에 전이중 통신 방식으로도 데이터를 주고받을 수 있다.



#### 충돌 도메인

충돌이 발생할 떄 영향을 끼치는 범위를 **충돌 도메인**이라고 한다. 예를 들어 허브같은 경우 연결되어 있는 모든 컴퓨터가 하나의 충돌 도메인이 된다. 반면 스위치는 충돌이 일어나도 모든 컴퓨터에 영향을 끼치지 않고 해당 컴퓨터에만 영향이 끼쳐질 것이다.그래서 효율도 당연히 스위치가 낫다. 네트워크를 지연시키지 않기  위해서는 충돌 도메인의 범위를 좁히는 것이 매우 중요하다



### ARP

목적지 컴퓨터의 IP주소를 이용하여 MAC 주소를 찾기 위한 프로토콜이다. 이더넷 프레임을 전송하려면 목적지 컴퓨터의 MAC 주소를 지정해야 한다. 만약 목적지 주소를 모르면 MAC 주소를 알아내기 위해 **네트워크에 브로드캐스트를 하는데 이것을 ARP 요청**이라고 한다.

이 요청에 대해 지정된  IP 주소를 가지고 있지 않은 컴퓨터는 응답하지 않지만, 지정된 IP 주소를 가진 컴퓨터는 MAC 주소를 응답으로 보내며 이를 ARP 응답이라고 한다.

출발지 컴퓨터는 MAC 주소를 얻고 이더넷 프레임을 만들 수 있다. 그리고 이렇게 얻으면 MAC 주소와 IP 주소의 매핑 정보를 메모리에 보관하며, 이 정볼르 ARP 테이블이라 한다. 만약 IP 주소가 변경되면 해당 MAC 주소도 함께 변경되므로 제대로 통신이 불가능할 것이다. 그래서 보존 기간을 ARP 캐시로 지정하고 일정 시간이 지나면 삭제하고 다시 요청한다.



#### 이더넷의 종류와 특징

이더넷은 케이블 종류나 통신 속도에 따라 다양한 규격으로 분류된다. 규격이름은 `[통신속도][전송방식][케이블]`로 이름이 구성된다. 예를 들면 10BASE5 이런식으로 지어진다.