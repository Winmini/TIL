# Forms



누가 코드를 봤을 때 깔끔하고, 일관적이며, 꼼꼼하다고 감탄하면 좋겠다. 프로그래머라면 형식을 깔끔하게 맞춰 코드를 짜야 한다. 코드 형식을 맞추기 위한 규칙을 정하고 그 규칙을 찾실히 따라야 한다. 팀으로 일한다면 팀이 합의해 규칙을 정하고 모두가 그 규칙을 따라야 한다. 필요하다면 규칙을 자동으로 적용하는 도구를 활용하자.



##### 형식을 맞추는 목적

무엇보다 먼저, 한가지를 분명히 짚고 넘어가자. 코드 형식은 <u>중요하다!</u> 너무 중요해서 무시하기 어렵다. 너무나도 중요하므로 융통성 없이 맹목적으로 따르면 안된다. 어쩌면 '돌아가는 코드'가 일차적인 의무라고 여겨질지 몰라도, 생각이 바뀌어야 한다. 오늘 구현한 기능이 다음 버전에서 바뀔 확률은 아주 높다. 하지만 오늘 구현한 코드의 가독성은 바뀔 코드의 품질에 지대한 영향을 미친다.



### 적절한 행 길이를 유지하라

세로 길이부터 살펴보자. 소스 코드는 얼마나 길어야 적당할까? 자바에서 파일 크기는 클래스 크기와 밀접하다. 클래스 크기는 클래스를 논하는 장에서 다루고, 지금은 파일 크기만을 고려하자.

대다수 자바 소스 파일은 크기가 어느정도일까? 평균 파일 크기는 약 65줄, 전체 파일중 대략 3분의 1이 40줄에서 100줄 내외정도 된다. 가장 긴 파일은 400줄, 가장 짧은 파일은 6줄이다.

실제로 JUnit, FitNesse, Time and Money는 상대적으로 파일 크기가 작다. 500줄 넘어가는 파일이 없으며 대다수가 200줄 미만이다. 반면 Tomcat과 Ant는 절반이상이 200줄을 넘기며 수천 줄이 넘어가는 파일도 있다. 이게 무엇을 말할까?

500줄을 넘지 않고 200줄 정도인 파일로도 커다란 시스템을 구축할 수 있다는 사실이다. 참고로 FitNesse는 50000줄에 육박하는 시스템이다.



### 개념은 빈 행으로 분리하라

거의 모든 코드는 왼쪽에서 오른쪽으로, 위에서 아래로 읽힌다. 각 행은 수식이나 절을 나타내고, 일련의 행 묶음은 환결된 생각 하나를 표현한다. 생각사이는 빈 행을 넣어 분리해야 마땅하다. 빈행은 새로운 개념을 시작한다는 시각적 단서이다. 코드를 읽어 내려가다 보면 빈 행 바로 다음 줄에 눈길이 멈춘다.



##### 세로 밀집도

줄바꿈이 개념을 분리한다면 세로 밀집도는 연관성을 의미한다. 즉, 서로 밀접한 코드 행은 세로로 가까이 놓여야 한다는 뜻이다. 다음 코드를 보자. 의미 없는 주석으로 두 인스턴스 변수를 떨어뜨려 놓았다.

```java
public class ReporterConfig{
  /**
  * 리포터 리스너의 클래스 이름
  */
  private String m_className;
  
  /**
  * 리포터 리스너의 속성
  */
  private List<Property> m_properties = new ArrayList<Property>();
  public void addProperty(Property property){
    m_properties.add(property);
  }
}
```

이 코드보다 다음 코드를 보면 코드가 '한눈'에 들어오는 것을 경험할 수 있다.

```java
public class ReporterConfig{
  private String m_className;
  private List<Property> m_properties = new ArrayList<Property>();
  public void addProperty(Property property){
    m_properties.add(property);
  }
}
```

머리와 눈을 덜 움직여도 된다.



##### 수직 거리

함수 연관 관계와 동작 방식을 이해하기 위해 이 함수에서 저함수로 오가며 소스 파일을 위아래로 뒤지고 뺑뺑이를 경험한 후 다시 돌아오고 혼란만 가중된 경험이 있나?

혹은 함수나 변수가 정의된 코드를 찾으려고 상속 관계를 줄줄이 거슬러 올라간 경험? 둘 다 달갑지 않다. 이해하고 싶은데 이 조각 저 조각 찾으려 가는건 시간과 노력을 소모한다.

서로 밀접한 개념은 세로로 가까이 둬야 한다. 물론 두 개념이 서로 다른 파일에 속한다면 규칙이 통하지 않는다. 하지만 타당한 근거가 없다면 서로 밀접한 개념은 한 파일에 속해야 마땅하다. 이게 바로 protected 변수를 피해야 하는 이유 중 하나다.



##### 변수 선언

변수는 사용하는 위치에 최대한 가까이 선언한다. 우리가 만든 함수는 매우 짧으므로 (짧지 않으면 짧게 만들어라) 지역 변수는 각 함수 맨 처음에 선언한다.



##### 인스턴스 변수

반면, 인스턴수 변수는 클래스 맨 처음에 선언한다. 변수 간에 세로로 거리를 두지 않는다. 잘 설계한 클래스는 많은 클래스 메서드가 인스턴스 변수를 사용하기 때문이다.

인스턴스 변수를 선언하는 위치는 아직도 논쟁이 분분하다. 마지막? 맨처음? 보통 자바는 맨처음이다. 어쨌든 잘 알려진 위치에 잘 모으는것이 중요하다.



##### 종속 함수

한 함수가 다른 함수를 호출한다면 두 함수는 세로로 가까이 배치한다. 또한 가능하다면 호출하는 함수를 호출되는 함수보다 먼저 배치한다. 그러면 프로그램이 자연스럽게 읽힌다. 규칙을 일관적으로 적용한다면 독자는 방금 호출한 함수가 잠시 후에 정의되리라는 사실을 예측한다. 이러면 호출되는 함수를 찾기가 쉬워지며, 그만큼 모듈 전체의 가독성도 높아진다.



##### 개념적 유사성

어떤 코드는 서로 끌어당긴다. 개념적인 친화도가 높기 때문이다. 이런 코드는 가까이 배치한다. 친화도가 높은 이유는, 종속성, 변수와 변수를 사용하는 함수, 비슷한 동작을 수행하는 일군의 함수 등이 있다.



##### 세로 순서

일반적으로 함수 호출 종속성은 아래 방향으로 유지한다. 고차원에서 저차원으로 자연스레 내려가게 만들자. 보통 잘쓰인 뉴스나 소개 글을 볼 때에도 중요한 부분이 먼저 나온다. 세세한 사항은 가장 마지막에 표현하도록 하자.



##### 가로 형식 맞추기

한 행은 가로로 얼마나 길어야 적당할까? 당연히 길면 좋지 않을 것을 미리 짐작했을 것 같다. 100자~120자 까지는 납득할만 하다. 하지만 그 이상은 주의 부족이다. 요새는 모니터가 가로로 길게 나오며, 글씨를 좀 작게 본다면 200자까지도 한 화면에 들어오지만 그렇게 하지말자.



##### 가로 공백과 밀집도

가로로는 공백을 사용해 밀접한 개념과 느슨한 개념을 표현한다.

```java
private void measureLine(String line){
  lineCount++;
  int lineSize = line.length();
  totalChars += lineSize;
  lineWidthHistogram.addLine(lineSize, lineCount);
  recordWidestLine(lineSize);
}
```

할당 연산자를 강조하기 위해 앞 뒤에 공백을 주었다. 할당문은 왼쪽 요소와 오른쪽 요소가 분명히 나뉜다. 공백을 넣으면 두 가지 주요 요소가 확실히 나뉜다.

반면 함수 이름과 이어지는 괄호 사이에는 공백이 없다. 서로 밀접하기 때문이다. 공백을 넣으면 한 개념이 아니라 별개로 보인다. 괄호안 인수도 쉼표와 공백으로 분리했다. 별개라는 사실을 보여주기 위해서이다. 연산자 우선순위를 강조하기 위해서도 공백을 사용한다. 연산자 우선순위를 자동으로 고려하기 힘드므로, 알아서 수정해주자.



##### 가로 정렬

탭으로 글자 앞머리를 맞추는 행위는 엉뚱한 부분을 강조하여 진짜 의도가 가려진다. 따라서 정렬하지 말자. 정렬이 필요할 정도로 목록이 길다면 문제는 정렬부족이 아니라 목록 길이이다. 선언부가 길다면 클래스를 쪼개야 한다는 의미다.



##### 들여쓰기

들여쓰기는 무시하지 말자. 짧은 if, while문 같은 경우 들여쓰기 규칙을 무시하고 싶을 떄가 있지만 들여쓰기는 항상 넣자. 가끔 빈 while문, for문을 접할 수도 있다 보통 좋은 구조는 아니므로 피하려하지만 만약 써야한다면 세미콜론은 새 행에다 제대로 들여써서 넣어주자.

```java
while (dis.read(buf, 0, readBufferSize) != -1)
  ;
```

그래야 눈에 띄게 된다.